@model IEnumerable<AppointmentViewModel>

@{
    ViewData["Title"] = "Appointments";
}

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:32px;">
    <h1>Appointments</h1>
    @if (User.IsInRole("Admin") || User.IsInRole("Trainer")) {
        <a class="btn" asp-action="Create">New Appointment</a>
    }
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success" role="alert">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger" role="alert">@TempData["Error"]</div>
}

@if (Model == null || !Model.Any()) {
    <div style="text-align:center; padding:60px 20px; color:#999;">
        <p style="font-size:16px;">No appointments yet. Book your first appointment to get started.</p>
    </div>
} else {
    <ul class="list">
        @foreach (var appointment in Model) {
            <li>
                <strong>@appointment.Date.ToString("dd.MM.yyyy") at @appointment.Time.ToString(@"hh\:mm")</strong>
                <div>Member: @appointment.UserName • Trainer: @appointment.TrainerName</div>
                <div>Service: @appointment.ServiceName • @appointment.Price.ToString("C2")</div>
                <div style="margin-top:8px;">
                    @{
                        var statusColor = appointment.Status switch {
                            "Pending" => "#fff3e0",
                            "Approved" => "#e8f5e9",
                            "Rejected" => "#ffebee",
                            "Canceled" => "#f5f5f5",
                            "Completed" => "#e3f2fd",
                            _ => "#f5f5f5"
                        };
                        var statusTextColor = appointment.Status switch {
                            "Pending" => "#e65100",
                            "Approved" => "#2e7d32",
                            "Rejected" => "#c62828",
                            "Canceled" => "#666",
                            "Completed" => "#1565c0",
                            _ => "#666"
                        };
                    }
                    <span style="display:inline-block; padding:4px 10px; background:@statusColor; color:@statusTextColor; border-radius:4px; font-size:13px; font-weight:500;">@appointment.Status</span>
                </div>
                @if (!string.IsNullOrEmpty(appointment.CanceledBy)) {
                    <div style="margin-top:8px; padding:8px; background:#fff3cd; border-left:3px solid #ffc107; border-radius:4px;">
                        <small style="color:#856404;">Canceled by <strong>@appointment.CanceledBy</strong> on @appointment.CanceledAt?.ToString("dd.MM.yyyy HH:mm")</small>
                    </div>
                }
                @if (User.IsInRole("Member") && string.Equals(appointment.Status, "Pending", System.StringComparison.OrdinalIgnoreCase)) {
                    <div style="margin-top:12px; display:flex; gap:10px;">
                        <form asp-action="Approve" asp-route-id="@appointment.AppointmentId" method="post" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn" style="margin:0;">Approve</button>
                        </form>
                        <form asp-action="Reject" asp-route-id="@appointment.AppointmentId" method="post" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn-secondary" style="margin:0;">Reject</button>
                        </form>
                    </div>
                }
                @if (User.IsInRole("Admin") || User.IsInRole("Trainer")) {
                    <div style="margin-top:12px; padding-top:12px; border-top:1px solid #e5e5e5;">
                        <form asp-action="Delete" asp-route-id="@appointment.AppointmentId" method="post" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn-secondary" onclick="return confirm('Delete this appointment?')" style="margin:0;">Delete</button>
                        </form>
                    </div>
                }
            </li>
        }
    </ul>
}
